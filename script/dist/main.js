"use strict";console.clear();let debug_mode=!0;const gameSetting={boostmode:!1},player=new Player,camera={x:0,y:0},map=new climbMap;function drawMap(e,t,a=0,r=0){for(const[s,i]of Object.entries(t)){const t=parseInt(s,16);if(!(t>12))for(let s=e.x-7;s<=e.x+7;s++){const e=i[s];if("number"==typeof e)DrawTile(BG_tile_imgs[e],s+a,t+r);else if(null!==e&&"object"==typeof e){const i=e.id,o=e.xflip,c=e.yflip;if("number"!=typeof i)continue;DrawTile(BG_tile_imgs[i],s+a,t+r,o,c)}else"string"==typeof e&&"path"==e&&DrawTile(BG_tile_imgs[274],s+a,t+r)}}}function drawDialog(e="base"){let t;if("base"==e)t={8:[10,0,4,4,4,4,4,4,4,4,4,4,4,1,10],9:[10,7,8,8,8,8,8,8,8,8,8,8,8,5,10],A:[10,7,8,8,8,8,8,8,8,8,8,8,8,5,10],B:[10,2,6,6,6,6,6,6,6,6,6,6,6,3,10]};else if("setting"==e)t={};else{if("charSelect"!=e)return;t={}}for(const[e,a]of Object.entries(t)){const t=parseInt(e,16);t>12||a.forEach((e,a)=>{DrawTile(Dialog_tile_imgs[e],a-7,t)})}}let dialogScoremodel="0 4 4 4 1 #n 2 6 6 6 3",lastTime=performance.now(),text_base_start_uuid=addText("   [시작]",-5,8.9,.65),text_base_char_uuid=addText("   [캐릭터]",-5,9.7,.65),text_base_setting_uuid=addText("   [설정]",-5,10.5,.65),text_score_uuid=addText("Score : N/A",4,-10,.65),select="start",screen_type="base",gameStartAnimated=!1,dialogEndY=.5,dialogScoreYpos=-10,renderAcc=0;function start(){screen_type="gameStart",map.update(player.start(map.data,camera)||camera),gameStartAnimated=!0,removeText(text_base_start_uuid),removeText(text_base_char_uuid),removeText(text_base_setting_uuid)}function ArrowUp(){if("base"===screen_type)switch(select){case"start":select="setting";break;case"char":select="start";break;case"setting":select="char"}}function ArrowDown(){if("base"===screen_type)switch(select){case"start":select="char";break;case"char":select="setting";break;case"setting":select="start";break;default:return}}function ArrowLeft(){}function ArrowRight(){}function Enter(){"base"===screen_type&&"start"===select&&start()}function onKeyDown(e){switch(e.key){case"ArrowUp":ArrowUp();break;case"ArrowDown":ArrowDown();break;case"ArrowLeft":ArrowLeft();break;case"ArrowRight":ArrowRight();break;case"z":case"Enter":Enter()}debug_mode&&"n"===e.key&&map.newline(camera.x)}function gameLoop(e){requestAnimationFrame(gameLoop);const t=(e-lastTime)/1e3;lastTime=e,gameStartAnimated&&(dialogScoreYpos+=.05*(dialogEndY-dialogScoreYpos),Math.abs(dialogEndY-dialogScoreYpos)<.01&&(dialogScoreYpos=dialogEndY,gameStartAnimated=!1)),renderAcc+=t;const a=1/(gameSetting.boostmode?60:30);if(renderAcc<a)return;renderAcc-=a,clearScreen(),applyRenderState(),drawMap(camera,map.data),player.CharacterDraw();const r=dialogScoremodel.split(" ");let s=0,i=0;if(r.forEach(e=>{if("#"===e.slice(0,1))"n"===e.slice(1,2)&&(s=0,i+=1);else{const t=parseInt(e);DrawTile(Dialog_tile_imgs[t],3+s,dialogScoreYpos+i),s+=1}}),!player.is_start){if(drawDialog(),"base"!==screen_type)return;switch(select){case"start":DrawTile(Dialog_tile_imgs[9],-5.3,8.7);break;case"char":DrawTile(Dialog_tile_imgs[9],-5.3,9.5);break;case"setting":DrawTile(Dialog_tile_imgs[9],-5.3,10.3)}}replaceText(text_score_uuid,`Score : ${player.height}`,3.85,dialogScoreYpos+.75,.5),drawTexts()}window.addEventListener("keydown",onKeyDown),requestAnimationFrame(gameLoop);